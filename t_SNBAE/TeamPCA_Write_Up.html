<!DOCTYPE html>

<!-- The point of this file is to write up my findings on PCA and NBA team shot distributions -->
<!-- Written by Matthew Osborne -->

<html>
    <head>
        <meta charset="utf-8">
        <title>
            Working Title
        </title>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <style type="text/css">
            #pca:hover {
                fill: red;
            }

            p {
              font-size: 20px;
              padding-left: 20px;
            }

            h1,h2,h3,h4 {
              padding-left: 20px;
            }

            .line {
                fill: none;
                stroke: black;
                stroke-width: 3;
            }

            table{
              border-collapse: collapse;
              width: 100%;
            }

            th{
              border-bottom: 1px solid;
              padding-right: 15px;
              text-align: left;
              font-size: 24px;
            }

            td{
              text-align: left;
              padding-right: 15px;
              text-align: left;
              font-size: 18px;
            }



            tr:hover {background-color: #A9A9A9;}
		</style>
    </head>
    <body>
        <h1 id="title">
            Working Title
        </h1>
        <h3 id="author">
            Matthew Osborne
        </h3>

        <div id = "writing" style = "width: auto; max-width: 1300px;">
          <p style = "font-size:40px;">
            <q>What these youngbloods have to understand
            is that this game has always been, and will always be, about buckets.</q>
            -Bill Russell
          </p>

          <p>
            Throughout the 2018-19 regular season NBA teams took, on average,
            about 89 shots per game, that's less than 23 a quarter.  In a game
            all about buckets, there really aren't many to go around. With shots
            being such a limited resource, their allocation can (and already has)
            greatly alter(ed) the game as we know it.
          </p>

          <p>
            Ever since the advent of Moreyball there's been a steady flow of takes on
            the shift towards the three heavy offense. Now, the point of this post is
            not to be the Kent Brockman of threes - I for one welcome our new
            three point overlords! - nor wax poetic about behemoths methodically
            backing each other down in the post. Rather, this post will introduce a novel
            way of examining the distribution of a team's shots around the court.
            In particular, a very popular data science technique, principal
            components analysis (PCA), will be applied to raw shot distribution
            data.
          </p>

          <h2>The Data</h2>

          <p>
            The NBA began accurately tracking the x,y position of every shot taken
            during a game back in the 2000-01 regular season. Using the python package
            <a href = "https://github.com/swar/nba_api">nba_api</a> this data can
            be collected and analyzed. Every single post up, fade-away jumper,
            or step-back three taken occurs in one of 15 sections of a court,
            outlined below.
          </p>


          <div id = "court-holder" style = "width:1300px; margin:auto; float:left;">
            <div id = "court-image" style = "width:500px; margin:auto; float:left;">
              <img src="Images/CourtZones.png" alt="Shot Zones" style = "width:500px;">
            </div>
            <div id = "court-table" style = "margin:auto; float:left;">
              <table style="width:100%">
              <tr >
                <th>ID</th>
                <th>Zone Name</th>
              </tr>
              <tr>
                <td>1</td>
                <td>Restricted Area</td>
              </tr>
              <tr>
                <td>2</td>
                <td>In the Paint, Center</td>
              </tr>
              <tr>
                <td>3</td>
                <td>In the Paint, Left</td>
              </tr>
              <tr>
                <td>4</td>
                <td>In the Paint, Right</td>
              </tr>
              <tr>
                <td>5</td>
                <td>Mid-Range, Left</td>
              </tr>
              <tr>
                <td>6</td>
                <td>Mid-Range, Right</td>
              </tr>
              <tr>
                <td>7</td>
                <td>Mid-Range, Center-Left</td>
              </tr>
              <tr>
                <td>8</td>
                <td>Mid-Range, Center-Right</td>
              </tr>
              <tr>
                <td>9</td>
                <td>Mid-Range, Center</td>
              </tr>
              <tr>
                <td>10</td>
                <td>Left Corner 3</td>
              </tr>
              <tr>
                <td>11</td>
                <td>Right Corner 3</td>
              </tr>
              <tr>
                <td>12</td>
                <td>Above the Break 3, Left</td>
              </tr>
              <tr>
                <td>13</td>
                <td>Above the Break 3, Right</td>
              </tr>
              <tr>
                <td>14</td>
                <td>Above the Break 3, Center</td>
              </tr>
              <tr>
                <td>15</td>
                <td>Backcourt</td>
              </tr>
            </table>
            </div>
      </div>


        <p>
          With the shot data from the NBA's official stats, each atttempt can be
          classified as occurring in one of these 15 zones. A team's shot zone distribution
          can then be created by taking the percentage of a team's total attempts that
          occurred in each zone. For example, here is the shot distribution for the
          2018-19 World Champion Toronto Raptors.
        </p>

        <div id = "toronto-table" style = "width:1300px; padding-left:20px; padding-bottom: 10px; margin:auto; float:left;">
          <table style="width:500px;">
            <tr >
              <th>Zone</th>
              <th>% of Toronto's Attempts</th>
            </tr>
            <tr>
              <td>Restricted Area</td>
              <td>32.16</td>
            </tr>
            <tr>
              <td>In the Paint, Center</td>
              <td>14.31</td>
            </tr>
            <tr>
              <td>In the Paint, Left</td>
              <td>0.55</td>
            </tr>
            <tr>
              <td>In the Paint, Right</td>
              <td>0.68</td>
            </tr>
            <tr>
              <td>Mid-Range, Left</td>
              <td>3.38</td>
            </tr>
            <tr>
              <td>Mid-Range, Right</td>
              <td>3.75</td>
            </tr>
            <tr>
              <td>Mid-Range, Center-Left</td>
              <td>1.74</td>
            </tr>
            <tr>
              <td>Mid-Range, Center-Right</td>
              <td>2.53</td>
            </tr>
            <tr>
              <td>Mid-Range, Center</td>
              <td>3.01</td>
            </tr>
            <tr>
              <td>Left Corner 3</td>
              <td>5.52</td>
            </tr>
            <tr>
              <td>Right Corner 3</td>
              <td>5.31</td>
            </tr>
            <tr>
              <td>Above the Break 3, Left</td>
              <td>9.16</td>
            </tr>
            <tr>
              <td>Above the Break 3, Right</td>
              <td>9.71</td>
            </tr>
            <tr>
              <td>Above the Break 3, Center</td>
              <td>7.98</td>
            </tr>
            <tr>
              <td>Backcourt</td>
              <td>0.22</td>
            </tr>
          </table>
        </div>



  <p>
    These shot distributions provide a snapshot of how a team allocated its limited
    resource in a particular season. This is great, however, it is slightly unmanageable
    to track how 15 numbers change over the course of 20 or so seasons. It would
    be nice if we could reduce that to one or two numbers to track over time.
  </p>

  <h2>
    PCA in the NBA
  </h2>

    <p>
      Enter Principal Components Analysis (PCA). PCA takes high dimensional data sets
      and reduces them to a more manageable number of dimensions. For example, PCA can
      take these 15 percentages and boil them down to just 1 or 2 numbers (<a href = "http://setosa.io/ev/principal-component-analysis/">
      Click to go to a link explaining PCA</a>). Running the 2018-19 Toronto Raptors'
      shot distribution through PCA produces the following two values: (0.093,-0.030).
      Doing this for every team's shot distribution from the 2000-01 to the 2018-19
      seaons produces the following plot, where a team's first PCA value is on the
      horizontal axis, and the second on the vertical.
    </p>
    <!--This holds the main plot--->
    <div id = "main-holder" style = "width:1300px; height:800px; margin:auto; float:left; padding-left:20px;">
        <div id = "main-plot" style = "width:950px; height:800px; float:left;">
        </div>
        <div id = "side-text" style = "width:350px; height:400px; float:right;">
            <div id = "buttons" style = "width:350px; height:50px; float:top;">
                <p>Highlighted Season: <span id = "season-button"></span> <br>
                    Highlighted Team: <span id = "team-button"></span>
                </p>
            </div>
            <div id = "text" style = "width:300px; height:350px; float:bottom;">
                <p style = "font-size:125%"><strong>Season: </strong> <span id = "Season" style= "color:white;"></span>
                <br>
                <strong>Team: </strong> <span id = "Team" style = "color:white;"></span><br>
                <span style = "font-size:90%">
                Shots in the Paint: <span id = "paint"></span> <br>
                Shots from Midrange: <span id = "midrange"></span> <br>
                Shots from 3: <span id = "three"></span></span>
                </p>
            </div>
        </div>
    </div>

    <p>
      <a href = "https://www.youtube.com/watch?v=TdUsyXQ8Wrs">Run, don't walk from
        the Blob of data points!</a> Don't worry this blob can make sense. When
        data is put through PCA, something called principal component vectors
        are also produced. These explain what the values mean in terms of the original
        data set. Here are the first two component vectors:
    </p>

    <div id = "component-vectors" style = "width:1250px; float:left; margin:auto;padding-left:20px; padding-bottom:20px;">
      <div id = "first-component" style = "width:600px; float:left; margin:auto;">
        <table style="width:570px;">
          <tr >
            <th>Zone</th>
            <th>First Principal Component Score</th>
          </tr>
          <tr>
            <td>
              Mid-Range, Left
            </td>
            <td>
              -0.581
            </td>
          </tr>
          <tr>
            <td>
              Mid-Range, Right
            </td>
            <td>
              -0.483
            </td>
          </tr>
          <tr>
            <td>
              Mid-Range, Center-Right
            </td>
            <td>
              -0.159
            </td>
          </tr>
          <tr>
            <td>
              Mid-Range, Center-Left
            </td>
            <td>
              -0.150
            </td>
          </tr>
          <tr>
            <td>
              Mid-Range, Center
            </td>
            <td>
              -0.055
            </td>
          </tr>
          <tr>
            <td>
              In the Paint, Left
            </td>
            <td>
              -0.020
            </td>
          </tr>
          <tr>
            <td>
              In the Paint, Right
            </td>
            <td>
              -0.012
            </td>
          </tr>
          <tr>
            <td>
              Backcourt
            </td>
            <td>
              0.002
            </td>
          </tr>
          <tr>
            <td>
              In the Paint, Center
            </td>
            <td>
              0.057
            </td>
          </tr>
          <tr>
            <td>
              Left Corner 3
            </td>
            <td>
              0.111
            </td>
          </tr>
          <tr>
            <td>
              Right Corner 3
            </td>
            <td>
              0.113
            </td>
          </tr>
          <tr>
            <td>
              Above the Break 3, Center
            </td>
            <td>
              0.259
            </td>
          </tr>
          <tr>
            <td>
              Restricted Area
            </td>
            <td>
              0.297
            </td>
          </tr>
          <tr>
            <td>
              Above the Break 3, Right
            </td>
            <td>
              0.307
            </td>
          </tr>
          <tr>
            <td>
              Above the Break 3, Left
            </td>
            <td>
              0.314
            </td>
          </tr>
        </table>
      </div>
      <div id = "second-component" style = "width:600px; float:left; margin:auto;">
        <table style="width:600px;">
          <tr >
            <th>Zone</th>
            <th>Second Principal Component Score</th>
          </tr>
          <tr>
            <td>
              Above the Break 3, Left
            </td>
            <td>
              -0.243
            </td>
          </tr>
          <tr>
            <td>
              Above the Break 3, Right
            </td>
            <td>
              -0.232
            </td>
          </tr>
          <tr>
            <td>
              Above the Break 3, Center
            </td>
            <td>
              -0.208
            </td>
          </tr>
          <tr>
            <td>
              In the Paint, Center
            </td>
            <td>
              -0.138
            </td>
          </tr>
          <tr>
            <td>
              Left Corner 3
            </td>
            <td>
              -0.092
            </td>
          </tr>
          <tr>
            <td>
              Right Corner 3
            </td>
            <td>
              -0.073
            </td>
          </tr>
          <tr>
            <td>
              In the Paint, Left
            </td>
            <td>
              -0.015
            </td>
          </tr>
          <tr>
            <td>
              In the Paint, Right
            </td>
            <td>
              -0.013
            </td>
          </tr>
          <tr>
            <td>
              Mid-Range, Center
            </td>
            <td>
              -0.010
            </td>
          </tr>
          <tr>
            <td>
              Backcourt
            </td>
            <td>
              0.001
            </td>
          </tr>
          <tr>
            <td>
              Mid-Range, Left
            </td>
            <td>
              0.010
            </td>
          </tr>
          <tr>
            <td>
              Mid-Range, Center-Left
            </td>
            <td>
              0.024
            </td>
          </tr>
          <tr>
            <td>
              Mid-Range, Center-Right
            </td>
            <td>
              0.044
            </td>
          </tr>
          <tr>
            <td>
              Mid-Range, Right
            </td>
            <td>
              0.048
            </td>
          </tr>
          <tr>
            <td>
              Restricted Area
            </td>
            <td>
              0.897
            </td>
          </tr>
        </table>
      </div>
    </div>

    <p>
      What do these two vectors mean? For any principal component vector, positive
      (meaning greater than 0) vector entries correspond to more positive principal
      component values. For example a team with 100% of their shots from Above the
      Break 3, Left will have as positive a first principal component value as possible
      because that is the most positive row of the first principal component vector table.
      On the other hand, a team that shot 100% of their shots from Mid-Range Left
      will have as negative (less than 0) a first principal component value as possible
      because that is the most negative row of the first principal component vector table.
    </p>

    <p>
      When it comes to the plot above, this means that teams with a larger percentage
      of their shots from the mid-range will be on the left (the negative side) of the chart,
      while teams shooting more from deep and in the restricted area will be on the right
      side (the positive side). These are precisely the regions of the court that have
      been endlessly discussed as being more or less efficient. The first principal component
      value is negative for the "less efficient" teams that shoot from mid-range, while
      the first principal component value is positive for the "more efficient" teams
      that shoot from three and under the rim. In terms of the earlier plot, more
      efficient teams step to the right, less efficient teams to the left please.
    </p>

    <p>
      Below is a plot that demonstrates what was explained above. Coloring each dot
      by the team's percentage of total shots taken from three or the
      restricted area paints a clear picture. Going from left to right on the PCA
      plot increases the percentage of total attempts from downtown or under the
      basket. A team's first PCA value captures the "efficiency" of their shot
      selection.
    </p>

    <!-- This holds the efficiency plot --->
    <div id = "eff-div", style = "width:1300px; height:650px; margin:auto; float:left; padding-left:20px;">
        <div id = "eff-plot" style = "width:800px; height:650px; margin:auto; float:left;">
        </div>
        <div id = "eff-legend" style = "width:150px; height:650px; margin:auto; float:left;">
        </div>
    </div>

    <p>
      The second PCA value captures whether a team prefers to shoot threes or close-up twos
      from the restricted area. Three point zones are the most negative in the second
      principal component vector, while the restricted area is overwhelmingly the
      most positive. Teams that live under the rim will be found near the top of
      the PCA value plot, while teams <a href = "https://www.cleveland.com/entertainment/2016/04/austin_carr_catch_phrases.html">
      shooting it from deep in the [approximate name of arena where game is being
      played]</a> can be found near the bottom. Check it out in the following two plots.
    </p>

    <!-- This holds the three plot --->
    <div id = "three-div", style = "width:1300px; height:650px; margin:auto; float:left; padding-left:20px;">
        <div id = "three-plot" style = "width:800px; height:650px; margin:auto; float:left;">
        </div>
        <div id = "three-legend" style = "width:100px; height:650px; margin:auto; float:left;">
        </div>
    </div>

    <!-- This holds the close plot --->
    <div id = "close-div", style = "width:1300px; height:650px; margin:auto; float:left; padding-left:20px;">
        <div id = "close-plot" style = "width:800px; height:650px; margin:auto; float:left;">
        </div>
        <div id = "close-legend" style = "width:100px; height:650px; margin:auto; float:left;">
        </div>
    </div>

    <p>
      These PCA scores have value in tracking the how a team allocates its shot
      attempts around the court. The first PCA value can be thought of as a shot
      distribution <i>Efficiency Measure</i>, with a positive value indicating
      an "efficient" team, and a negative value an "unefficient" team. The second
      PCA value can then be considered a way to measure a team's tendency to shoot
      from three or close range, with negative values meaning more threes and positive
      values meaning more shots at the basket.
    </p>

    <h2>
      Crawling Towards Efficiency
    </h2>

    <p>
      With the success of the Houston Rockets' three heavy offense, much has been
      made of the NBA's transition into a gun slinger league. Mathematically this
      transition does make sense. According to research performed by NBA analyst
      and geographer <a href = "https://www.espn.com/nba/story/_/id/25459090/carmelo-anthony-last-great-american-ball-hog">
      Kirk Goldsberry</a>, the restricted area and just beyond the arc are the
      only spots on the court with a positive return on investment, meaning the
      only places where the expected points per shot is above 1. It is pretty straight
      forward, 23 shots from spots with expected points per shot above 1 should
      net more than 23 points, 23 shots from spots with expected points per shot
      below 1 should net less than 23 points. As a reminder, the team with
      more points typically wins the game.
    </p>

    <p>
      It's a copycat league, so as Houston started to have success against the
      game's Goliath State Warriors, other teams started to follow suit devising
      shot distributions that primarily feature these "efficient" zones of the
      court. If this is true, it should be reflected in the PCA chart. Click the
      'Start!' button of the graphic below to see how PCA values have progressed
      over the last 20 seasons.
    </p>

    <!--This holds the time lapse plot--->
    <div id = "time-holder" style = "width:1300px; height:700px; margin:auto; float:left; padding-left:20px;">
        <div id = "time-lapse-plot" style = "width:900px; height:750px; float:left;">
        </div>
        <div id = "time-side" style = "width:100px; height 650px; float:left;">
            <div id = "time-button" style = "width:100px; height 650px; position: relative; top:60px; left: -100px;">
                <button type="button" style = "font-size:16px; padding: 5px 2px;">Start!</button>
            </div>
        </div>
    </div>

    <p>
      And <a href = "https://www.youtube.com/watch?v=rjA5A86V6SY">there it is.</a>
      As the seasons progress there is a clear shift from the left of the chart
      (the area where less efficient midrange heavy teams live), to the right of
      the chart (where the threes and restricted areas roam), as expected.
    </p>

    <h2>
      Team Ramblings
    </h2>

    <p>
      Beyond the NBA wide season to season transitions these PCA coordinates can
      be used to examine the shot distributions of particular teams. What follows
      are four vignettes on individual team PCA transitions.
    </p>

    <h3>
      If it Ain't Broke Don't Fix it
    </h3>

    <p>
      The Warriors have the most prolific shooting duo in history,
      <a href = "https://www.youtube.com/watch?v=JTA5aBmmYJg">Steph</a> and
      <a href = "https://www.youtube.com/watch?v=uRE1X_DXDp0">Klay</a>, so it's
      a no brainer that they take advantage of this more efficient approach, right?
      Well yes, but actually no. Click the 'Start!' button on the below plot to
      watch Golden State's progression since 2014 compared to the rest of the
      NBA.
    </p>

    <!--Warriors Plot div--->
    <div id = "warriors-div", style = "width:1300 px; height: 600px; min-width:1300px; margin: auto; float:left; ">
        <div id = "warriors-plot" style = "width: 800px; height: 600px; margin: auto; float: left;">
        </div>
        <div id = "warriors-side" style = "width: 500px; height: 600px; margin: auto; float: right;">
          <div id = "warriors-button-div" style = "position: relative; top:50px; left: -50px;">
            <button id="warriors-button" style = "font-size:16px; padding: 5px 2px;">Start!</button>

            <p style = "font-size:24px;"><b>Number of Teams <br> Right of The Warriors</b> <br> <br>
              2014-15: <span id = "fourteen"></span> <br>
              2015-16: <span id = "fifteen"></span> <br>
              2016-17: <span id = "sixteen"></span> <br>
              2017-18: <span id = "seventeen"></span> <br>
              2018-19: <span id = "eighteen"></span>
            </p>

          </div>
        </div>
    </div>

    <p>
      One refrain throughout the 2018-19 season explaining the Warriors struggles
      (if a fifth straight finals birth can be called that) was that
      <a href = "https://www.wsj.com/articles/the-end-of-the-golden-state-warriors-era-of-invicibility-11560517376">
      the rest of the NBA got better</a>. Did it, or did it just get smarter?
    </p>

    <p>
      The Warriors started their dynasty run near the front of the herd, when it came to
      shot distribution. In their record breaking 2015-16 season they placed their shots
      more "efficiently" than all but two teams in the league, with over 35% of their shots
      coming from 3 (second to only the Houston Rockets). Then they got stagnant.
      After the 2015-16 season they watched the rest of the association pass them by,
       GSW ended the 2018-19 season as the team
      with the second highest percent of shots from mid-range (second only to the 3
      detesting <a href = "https://www.youtube.com/watch?v=JR5c4ZinP9M">Spurs</a>).
    </p>

    <p>
      But the Warriors went 3 for 5 in the NBA finals, and probably would have gone
      4 for 5 if either of Klay or KD don't get hurt (sorry Raptors fans, but its true).
      So does shot distribution relative to the rest of the league even matter? If
      a team features 4 future hall of famers, probably not so much, especially when
      2 (possibly <a href = "https://www.youtube.com/watch?v=YVsah5EBKuI">3</a>) are
      hall of famers because of their ability to make efficient shots. Klay and Curry
      are so good at converting threes that their team can get away without taking
      as many as the rest of the NBA.
    </p>

    <p>
      For the second half of this decade the Warriors more or less ran back the same
      shot distribution season after season, to historic success. If it ain't broke
      don't fix it. The thing is, it might actually be broke. Heading into the
      2019-20 season the Warriors will have to replace Kevin Durant and Klay Thompson
      (temporarily at least) with D'Angelo Russell. While D'Angelo is a rising star,
      it is insanity to think Steve Kerr could just slot him into the same offensive
      scheme and expect similar results. It seems likely they will make a shift toward
      the right of the PCA chart.
    </p>



    <h3>
      Houston We Have a Harden
    </h3>

    <p>
      No team is more renowned (or even reviled) for their reliance on 3s and layups
      than the Houston Rockets. While these more "efficent" shot distributions have
      been deemed "Moreyball" the PCA plot reveals that it was not Daryl that led
      this transition. Morey has been GM of the Rockets since 2007, but Houston
      did not significantly change its shot distribution until a few years later.
      Click the below plot to see what team events do coincide with noticeable
      changes in shot distribution.
    </p>

    <!--Rockets Plot div--->
    <div id = "rockets-div", style = "width:1300px; height: 600px; margin: auto; float:left; padding-left:20px;">
        <div id = "rockets-plot" style = "width: 1300px; height: 600px; margin: auto; float: left;">
        </div>
    </div>

    <p>
      Maybe a better name would be "Hardenball"? Now it could be argued that Daryl
      discovered the competitive advantage that 3 > 2, traded for a player
      that is perfect for such an offense, and then hired a coach that would take
      that offense to the extreme. But, it is equally likely that Morey just traded
      for a good player that was (stupidly) available, and then built an offensive
      system around said player that would help him, and the team, succeed. Either
      way, it's clear that it was not what we call Moreyball until James Harden
      touched down in Houston.
    </p>

    <h3>
      The Process Was About More Than Tanking
    </h3>

    <p>
      In 2013 NBA analytics martyr Sam Hinkie (and current head coach Brett Brown)
      was hired by the 76ers to begin their process. While the "The Process" has
      become synonymous with years of losing to accrue future assets, it also
      signified a major shift in the Sixers' shot allocation. Again, click the
      plot below to observe.
    </p>

    <!--76ers Plot div-->
    <div id = "sixers-div", style = "width:1300 px; height: 600px; margin: auto; float:left; padding-left:20px;">
        <div id = "sixers-plot" style = "width: 1300px; height: 600px; margin: auto; float: left;">
        </div>
    </div>

    <p>
      In that inaugural process season, Philadelphia had one of the most "efficient"
      shot distributions in the whole NBA. Not only that, their jump from 2012-13 to
      2013-14 represents one of the largest season to season shifts on the PCA plot.
      However, similar to the
      Warriors, they stopped moving forward. This could be due to their consistent personnel
      decisions, opting to draft <a href = "https://www.youtube.com/watch?v=DkqGMNhSOWU">players
      that can't shoot</a>, or it could be the one constant the team has shared every
      season since The Process began, Coach Brett Brown.
    </p>

    <p>
      It will be interesting to see how the Sixers' shot distribution develops
      this upcoming season. They lost their best gunner to the Pelicans this offseason,
      but Simmons has allegedly been working on his jumper all Summer. The 2019-20
      season could provide further evidence that shot distribution is a characteristic
      of the coach, if it stays in the familiar Philadelphia spot.
    </p>

    <h3>
      LeBron Who?
    </h3>

    <p>
      When LeBron declared he was 'Coming Home' in the summer of 2014, the
      Cleveland Cavaliers became the perennial Eastern Conference representative in
      the NBA finals. The return of the King did not merely alter the title odds for
      his home town team, it also signified a shift in their shot distribution.
    </p>

    <p>
      However, when LBJ left for purpler pastures he did not take the Cavaliers'
      shot distribution with him. Click the plot below.
    </p>

    <!--Cavs Plot div--->
    <div id = "cavs-div", style = "width:1300 px; height: 600px; margin: auto; float:left; padding-left:20px;">
        <div id = "cavs-plot" style = "width: 1300px; height: 600px; margin: auto; float: left;">
        </div>
    </div>

    <p>
      Despite losing the star of Space Jam 2, Cleveland placed its attempts in a
      near identical manner. This seems somewhat odd, since much of the Cavaliers'
      offense was predicated on LeBron, particularly in the 2017-18 run. It can't
      really be chalked up to roster consistency, the Cavaliers roster was somewhat of
      a revolving door in the 2018-19 season as the team attempted to address a deluge
      of injuries as well as clean up their cap situation moving forward.
      It could be argued that this is a remnant of the coaching staff that was in
      place during LeBron's second stint, but the Cavaliers notably lost head coach
      Tyronn Lue. Perhaps interim coach Larry Drew was the offensive mastermind this
      entire time.
    </p>

    <p>
      Whatever the reason, it wouldn't be surprising to see a massive departure
      from their current PCA cluster this coming season. With an entirely new
      coaching staff, and an influx of freshly drafted talent, the Cavaliers will
      probably see change in 2019.
    </p>

    <h3>
      Kenny Atkinson Was a Nets Gain
    </h3>

    <p>
      Three years after one of the worst trades in NBA history, the Nets brought
      in Kenny Atkinson to help right the ship. While it took Atkinson 3 seasons
      at the helm to bring a season with a winning record (42-40, so just barely),
      what he immediately brought was a new shot distribution strategy. Click
      the plot below.
    </p>

    <!--Nets Plot div--->
    <div id = "nets-div", style = "width:1300 px; height: 600px; margin: auto; float:left; padding-left:20px;">
        <div id = "nets-plot" style = "width: 1300px; height: 600px; margin: auto; float: left;">
        </div>
    </div>

    <p>
      Throughout Atkinson's tenure the Nets have been one of the furthest right
      teams on the PCA chart. Typically they trailed only Houston, and in 2018-19
      they were one of four teams to shoot over 90% of their shots from outside
      the midrange. Atkinson has leaned into Moreyball hard, but not to much success.
      This coming season will be interesting as it marks Atkinson's first season
      with etablished all stars. How will he integrate Kyrie Irving and Deandre
      Jordan into this system?
    </p>

    <h2>
      What PCA Has to Say
    </h2>

    <p>
      These PCA coordinates have allowed an examination of the macro shot distribution
      trends of the NBA as well as the micro trends that season to season team
      decisions produce. The two numbers provide a novel way of analyzing team shot
      distributions beyond the 3, mid-range, and paint shot percentages. While those
      percentages will always be important, the procedure presented above is a nice
      supplement to the standard analyses.
    </p>

    <p>
      For one, when the shot distribution percentages are run through the PCA algorithm
      there is no prior knowledge or bias that suggests the importance of the 3 point line
      before the algorithm is run. PCA picked up on this trend ignorant of basketball
      talking heads. PCA allows the data to speak for itself.
    </p>

    <p>
      This feature will be important going forward. The 2018-19 season highlighted how much
      teams are finally buying into the efficiency of their shot distributions. Much like on-base
      percentage in baseball, the fact that 3 > 2 is no longer a competive advantage.
      In hindsight the shift from long 2s to 3s was obvious, but when the three point
      line was introduced nobody took it seriously. People will likely not see the next
      innovation coming, if they did teams would already be doing it. PCA could help
      identify the next trend as its happening rather than the 6 or so years it took
      for everyone to catch up with Houston. PCA could be a canary in the shot distribution
      coal mine.
    </p>








    <!--Makes all of the plots--->
		<script type="text/javascript">
            d3.csv("Data/TeamDataForHTML.csv").then(function(data){
              /* Main Plot */
              // Variables for the main plot
              var main_width = 950
              var main_height = 750
              var main_padding = 70
              var padding = 50

              // svg for the main plot
              var svg = d3.select("#main-plot")
                              .append("svg")
                              .attr("width", main_width)
                              .attr("height", main_height);

              /* Time Lapse Plot */
              // Variables for the time lapse plot
              var time_width = 800
              var time_height = 650

              // svg for the time lapse plot
              var time_svg = d3.select("#time-lapse-plot")
                                  .append("svg")
                                  .attr("width",time_width)
                                  .attr("height",time_height);

              time_svg.append("text")
                          .attr("x",70)
                          .attr("y",85)
                          .attr("font-size","24px")
                          .attr("id","season-text")
                          .text("Season:");

              /* Three Plot */
              var three_width = 700
              var three_height = 550
              var three_legend_svg_width = 200
              var three_legend_svg_height = 650
              var three_legend_width = 25
              var three_legend_height = 500


              var three_svg = d3.select("#three-plot")
                                  .append("svg")
                                  .attr("width",three_width)
                                  .attr("height",three_height);

              var three_legend_svg = d3.select("#three-legend")
                                          .append("svg")
                                          .attr("width", three_legend_svg_width)
                                          .attr("height", three_legend_svg_height)
                                          .style("position","relative")
                                          .style("left",-120);

              /* Close Plot */
              var close_width = 700
              var close_height = 550
              var close_legend_svg_width = 200
              var close_legend_svg_height = 650
              var close_legend_width = 25
              var close_legend_height = 500

              var close_svg = d3.select("#close-plot")
                                  .append("svg")
                                  .attr("width",close_width)
                                  .attr("height",close_height);

              var close_legend_svg = d3.select("#close-legend")
                                          .append("svg")
                                          .attr("width", close_legend_svg_width)
                                          .attr("height", close_legend_svg_height)
                                          .style("position","relative")
                                          .style("left",-120);


              /* Efficiency Plot */
              var eff_width = 700
              var eff_height = 550
              var eff_legend_svg_width = 200
              var eff_legend_svg_height = 650
              var eff_legend_width = 25
              var eff_legend_height = 500

              var eff_svg = d3.select("#eff-plot")
                                  .append("svg")
                                  .attr("width",close_width)
                                  .attr("height",close_height);


              var eff_legend_svg = d3.select("#eff-legend")
                                          .append("svg")
                                          .attr("width", eff_legend_svg_width)
                                          .attr("height", eff_legend_svg_height)
                                          .style("position","relative")
                                          .style("left",-120);




              var buffer = .01



              /* First the main plot */
              // xscale
              var xScale = d3.scaleLinear()
                              .domain([d3.min(data, function(d){return parseFloat(d.pca_1);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_1);}) + buffer])
                              .range([main_padding, main_width - main_padding]);

              // yscale
              var yScale = d3.scaleLinear()
                              .domain([d3.min(data, function(d){return parseFloat(d.pca_2);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_2);}) + buffer])
                              .range([main_height - main_padding, main_padding]);

              // make axes
              var xAxis = d3.axisBottom(xScale);

              var yAxis = d3.axisLeft(yScale);


              // This function draws the pca values for each team
              var drawCircles = function(){
                  var circles = svg.selectAll("circle")
                                  .data(data)
                                  .enter()
                                  .append("circle");

                  circles.attr("cx", function(d){
                              return xScale(parseFloat(d.pca_1));
                          })
                          .attr("cy", function(d){
                              return yScale(parseFloat(d.pca_2));
                          })
                          .attr("r", 5)
                          .attr("fill","black")
                          .attr("stroke","black")
                          .attr("stroke-width",2)
                          .attr("id","pca")
                          .attr("opacity",.8)
                          .on("mouseover", function(d){
                                  d3.select("#Team")
                                      .style("color", "black")
                                      .text(d.TEAM_NAME);

                                  d3.select("#Season")
                                      .style("color", "black")
                                      .text(d.Season);

                                  d3.select("#paint")
                                      .style("color", "black")
                                      .text(function(){
                                          var perc = parseFloat(d['CLOSE_PERC_OF_TOT'])

                                          perc = 100 * perc

                                          perc = perc.toFixed(2).toString()

                                          return perc.concat("%")
                                      });

                                  d3.select("#midrange")
                                      .style("color", "black")
                                      .text(function(){
                                          var perc = parseFloat(d['MID_PERC_OF_TOT'])

                                          perc = 100 * perc

                                          perc = perc.toFixed(2).toString()

                                          return perc.concat("%")
                                      });

                                  d3.select("#three")
                                      .style("color", "black")
                                      .text(function(){
                                          var perc = parseFloat(d['3_PERC_OF_TOT'])

                                          perc = 100 * perc

                                          perc = perc.toFixed(2).toString()

                                          return perc.concat("%")
                                      });
                          })
                          .on("mouseout", function(d){
                                  d3.select("#Team")
                                      .style("color", "white")
                                      .text("");

                                  d3.select("#Season")
                                      .style("color","white")
                                      .text("");

                                  d3.select("#paint")
                                      .style("color","white")
                                      .text("");

                                  d3.select("#midrange")
                                      .style("color","white")
                                      .text("");

                                  d3.select("#three")
                                      .style("color","white")
                                      .text("");
                          });





              }

                // This function updates the circles when we slect season/team
                var updateCircles = function(){
                    var season_sel = document.getElementById('season-sel');
                    var team_sel = document.getElementById('team-sel');

                    var season = season_sel.options[season_sel.selectedIndex].value;
                    var team_id = team_sel.options[team_sel.selectedIndex].value;

                    svg.select("#season-group")
                          .transition()
                          .delay(0)
                          .duration(0)
                          .remove();

                    svg.select("#team-group")
                          .transition()
                          .delay(0)
                          .duration(0)
                          .remove();




                    if (season === "All"){
                        if (team_id === "All"){
                            svg.selectAll("circle")
                                .data(data)
                                .transition()
                                .attr("opacity",.8)
                                .duration(1000);

                            svg.selectAll("#dot-text")
                                  .transition()
                                  .delay(0)
                                  .duration(0)
                                  .remove();


                        } else{
                          var season_group = svg.append("g")
                                                  .attr("id","season-group");

                          season_group.selectAll("text")
                                      .data(data)
                                      .enter()
                                      .filter(function(d){return d.TEAM_ID === team_id;})
                                      .append("text")
                                      .attr("id","team-text")
                                      .attr("x", function(d){
                                                  return xScale(parseFloat(d.pca_1)) - 10;
                                              })
                                      .attr("y", function(d){
                                          return yScale(parseFloat(d.pca_2)) - 8;
                                      })
                                      .attr("opacity",1)
                                      .text(function(d){return d.Season});

                            svg.selectAll("circle")
                                .data(data)
                                .filter(function(d){return d.TEAM_ID != team_id;})
                                .transition("transition1")
                                .duration(0)
                                .delay(0)
                                .attr("opacity",.05);

                            svg.selectAll("circle")
                                .data(data)
                                .filter(function(d){return d.TEAM_ID === team_id;})
                                .transition("transition2")
                                .duration(0)
                                .delay(0)
                                .attr("opacity",.9);
                        }
                    } else{
                        if(team_id === "All"){
                          var team_group = svg.append("g")
                                                  .attr("id","team-group");



                          team_group.selectAll("text")
                                      .data(data)
                                      .enter()
                                      .filter(function(d){return d.Season === season;})
                                      .append("text")
                                      .attr("id","team-text")
                                      .attr("x", function(d){
                                                  return xScale(parseFloat(d.pca_1)) - 10;
                                              })
                                      .attr("y", function(d){
                                          return yScale(parseFloat(d.pca_2)) - 8;
                                      })
                                      .attr("opacity",1)
                                      .text(function(d){return d.ABBR});




                            svg.selectAll("circle")
                                .data(data)
                                .filter(function(d){return d.Season != season;} )
                                .transition("transition1")
                                .delay(0)
                                .duration(0)
                                .attr("opacity",.05);

                            svg.selectAll("circle")
                                .data(data)
                                .filter(function(d){return d.Season === season;})
                                .transition("transition2")
                                .delay(0)
                                .duration(0)
                                .attr("opacity", .9);
                        } else{
                            svg.selectAll("circle")
                                .data(data)
                                .filter(function(d){return (d.Season != season) || (d.TEAM_ID != team_id);} )
                                .transition("transition1")
                                .attr("opacity",.05);

                            svg.selectAll("circle")
                                .data(data)
                                .filter(function(d){return (d.Season === season) && (d.TEAM_ID == team_id);})
                                .transition("transition2")
                                .duration(1000)
                                .attr("opacity",.9);
                        }
                    }

                }


                // put in the season dropdown button
                var seasonDropdown = d3.select("#season-button")
                                        .insert("select", "svg")
                                        .attr("id","season-sel")
                                        .on("change", updateCircles);



                seasonDropdown.selectAll("option")
                                .data(d3.map(data, function(d){return d.Season;}).keys())
                                .enter()
                                .append("option")
                                .text(function(d){return d;})
                                .attr("value",function(d){return d;});

                seasonDropdown.append("option")
                                .text("All")
                                .attr("value", "All")
                                .property("selected","All");

                // put in the team dropdown
                var teamDropdown = d3.select("#team-button")
                                        .insert("select","svg")
                                        .attr("id","team-sel")
                                        .on("change",updateCircles);

                teamDropdown.selectAll("option")
                                .data(data)
                                .enter()
                                .filter(function(d){return d.Season === "2018-19";})
                                .append("option")
                                .text(function(d){return d.TEAM_NAME;})
                                .attr("value",function(d){return d.TEAM_ID;});

                teamDropdown.append("option")
                            .text("All")
                            .attr("value","All")
                            .property("selected","All");


                // append the axes to the plot
                svg.append("g")
                    .attr("id","ticks")
                    .style("font-size",16)
                    .attr("transform", "translate(0, " + (main_height - main_padding) +")")
                    .call(xAxis);

                svg.append("g")
                    .attr("id","ticks")
                    .style("font-size",16)
                    .attr("transform", "translate(" + main_padding  + ",0)")
                    .call(yAxis);

                svg.append("text")
                    .attr("transform",
                          "translate(" + (main_width/2) + " ," +
                          (main_height - 20) + ")")
                    .style("text-anchor", "middle")
                    .attr("font-size",24)
                    .text("First PCA Value");

                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", -7)
                    .attr("x",0 - (main_height / 2))
                    .attr("dy", "1em")
                    .attr("font-size",24)
                    .style("text-anchor", "middle")
                    .text("Second PCA Value");

                svg.append("text")
                    .attr("x", main_padding + 10)
                    .attr("y", main_padding + 10)
                    .attr("font-size",18)
                    .text("Hover over a dot to");

                svg.append("text")
                    .attr("x", main_padding + 10)
                    .attr("y", main_padding + 30)
                    .attr("font-size",18)
                    .text("highlight the team it represents");


                // draw the circles onto the svg
                drawCircles();





                /* time lapse plot */
                // Make the x scale
                var time_xScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_1);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_1);}) + buffer])
                                .range([padding, time_width - padding]);

                // Make the y scale
                var time_yScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_2);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_2);}) + buffer])
                                .range([time_height - padding, padding]);

                // make the x axis
                var time_xAxis = d3.axisBottom(time_xScale);

                // make the y axis
                var time_yAxis = d3.axisLeft(time_yScale);

                // put on the x axis
                time_svg.append("g")
                    .attr("transform", "translate(0, " + (time_height - padding) +")")
                    .call(time_xAxis);

                // put on the y axis
                time_svg.append("g")
                    .attr("transform", "translate(" + padding + ",0)")
                    .call(time_yAxis);

                time_svg.append("text")
                        .attr("transform",
                              "translate(" + (time_width/2) + " ," +
                              (time_height - 10) + ")")
                        .style("text-anchor", "middle")
                        .attr("font-size",18)
                        .text("Shot Efficiency Measure");

                time_svg.append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 0-5)
                        .attr("x",0 - (time_height / 2))
                        .attr("dy", "1em")
                        .attr("font-size",18)
                        .style("text-anchor", "middle")
                        .text("Restriced Area vs. Three Measure");

                // This function runs through the season sequence
                var seasonSequence = function(){
                    var circles = time_svg.selectAll("circle")
                                            .data(data)
                                            .enter()
                                            .append("circle");

                    circles.attr("cx", function(d){
                                return time_xScale(parseFloat(d.pca_1));
                            })
                            .attr("cy", function(d){
                                return time_yScale(parseFloat(d.pca_2));
                            })
                            .attr("r", 5)
                            .attr("fill","black")
                            .attr("id","pca")
                            .attr("opacity",.01);

                   var seasons = d3.map(data, function(d){return d.Season;}).keys();

                   var seasonsLength = seasons.length;

                   time_svg.select("#season-text")
                             .transition("text")
                             .delay(0)
                             .duration(0)
                             .text("Season:");

                   time_svg.selectAll("circle")
                             .transition("circles")
                             .delay(0)
                             .duration(0)
                             .attr("opacity",0);

                   for (var i = 0; i < seasonsLength; i++) {
                      var delay = 1000;
                      var dur = 300;

                      time_svg.selectAll("#season-text")
                                .transition("text")
                                .delay(delay*i)
                                .text("Season: " + seasons[i]);

                      time_svg.selectAll("circle")
                                    .data(data)
                                    .filter(function(d){return d.Season != seasons[i];})
                                    .transition("circles")
                                    .delay( (delay*i) )
                                    .attr("opacity",.01)
                                    .duration(dur);

                      time_svg.selectAll("circle")
                                    .data(data)
                                    .filter(function(d){return d.Season === seasons[i];})
                                    .transition("circles")
                                    .delay( (delay*i) )
                                    .duration(dur)
                                    .attr("opacity",.9);
                    }

                    time_svg.select("#season-text")
                              .transition("text")
                              .delay(delay*(seasonsLength) + 500)
                              .text("2000-01 VS. 2018-19");

                    time_svg.selectAll("circle")
                            .data(data)
                            .filter(function(d){return d.Season === "2000-01";})
                            .transition("circles")
                            .delay(delay*seasonsLength + 500)
                            .duration(dur)
                            .attr("opacity",.9);

                }

                // this adds the on click function to the time-lapse button
                d3.select("#time-button")
                    .on("click",seasonSequence);

                /* Three plot */
                // Make the x scale
                var three_xScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_1);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_1);}) + buffer])
                                .range([padding, three_width - padding]);

                // Make the y scale
                var three_yScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_2);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_2);}) + buffer])
                                .range([three_height - padding, padding]);

                // make the x axis
                var three_xAxis = d3.axisBottom(three_xScale);

                // make the y axis
                var three_yAxis = d3.axisLeft(three_yScale);

                // put on the x axis
                three_svg.append("g")
                    .attr("transform", "translate(0, " + (three_height - padding) +")")
                    .call(three_xAxis);

                // put on the y axis
                three_svg.append("g")
                    .attr("transform", "translate(" + padding + ",0)")
                    .call(three_yAxis);

                /* Close Plot */
                // Make the x scale
                var close_xScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_1);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_1);}) + buffer])
                                .range([padding, close_width - padding]);

                // Make the y scale
                var close_yScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_2);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_2);}) + buffer])
                                .range([close_height - padding, padding]);

                // make the x axis
                var close_xAxis = d3.axisBottom(close_xScale);

                // make the y axis
                var close_yAxis = d3.axisLeft(close_yScale);

                // put on the x axis
                close_svg.append("g")
                    .attr("transform", "translate(0, " + (close_height - padding) +")")
                    .call(close_xAxis);

                // put on the y axis
                close_svg.append("g")
                    .attr("transform", "translate(" + padding + ",0)")
                    .call(close_yAxis);

                close_svg.append("text")
                        .attr("transform",
                              "translate(" + (close_width/2) + " ," +
                              (close_height - 10) + ")")
                        .style("text-anchor", "middle")
                        .attr("font-size",18)
                        .text("First PCA Value");

                close_svg.append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 0-5)
                        .attr("x",0 - (close_height / 2))
                        .attr("dy", "1em")
                        .attr("font-size",18)
                        .style("text-anchor", "middle")
                        .text("Second PCA Value");

                three_svg.append("text")
                        .attr("transform",
                              "translate(" + (close_width/2) + " ," +
                              (close_height - 10) + ")")
                        .style("text-anchor", "middle")
                        .attr("font-size",18)
                        .text("First PCA Value");

                three_svg.append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 0-5)
                        .attr("x",0 - (close_height / 2))
                        .attr("dy", "1em")
                        .attr("font-size",18)
                        .style("text-anchor", "middle")
                        .text("Second PCA Value");


                /* Efficiency Plot */
                var effPlot= function(){
                    // Make the x scale
                    var eff_xScale = d3.scaleLinear()
                                    .domain([d3.min(data, function(d){return parseFloat(d.pca_1);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_1);}) + buffer])
                                    .range([padding, eff_width - padding]);

                    // Make the y scale
                    var eff_yScale = d3.scaleLinear()
                                    .domain([d3.min(data, function(d){return parseFloat(d.pca_2);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_2);}) + buffer])
                                    .range([eff_height - padding, padding]);

                    // make the x axis
                    var eff_xAxis = d3.axisBottom(eff_xScale);

                    // make the y axis
                    var eff_yAxis = d3.axisLeft(eff_yScale);

                    // put on the x axis
                    eff_svg.append("g")
                        .attr("transform", "translate(0, " + (eff_height - padding) +")")
                        .call(eff_xAxis);

                    // put on the y axis
                    eff_svg.append("g")
                        .attr("transform", "translate(" + padding + ",0)")
                        .call(eff_yAxis);

                    var color = d3.scaleSequential().domain([d3.min(data, function(d){return  parseFloat(d['Restricted_Area-Center(C)_PERC_TOT']) + parseFloat(d['3_PERC_OF_TOT']);}), d3.max(data, function(d){return parseFloat(d['Restricted_Area-Center(C)_PERC_TOT']) + parseFloat(d['3_PERC_OF_TOT']);})])
                                        .interpolator(d3.interpolateInferno);

                    var circles = eff_svg.selectAll("circle")
                                            .data(data)
                                            .enter()
                                            .append("circle");

                    eff_svg.append("text")
                            .attr("transform",
                                  "translate(" + (eff_width/2) + " ," +
                                  (eff_height - 10) + ")")
                            .style("text-anchor", "middle")
                            .attr("font-size",18)
                            .text("First PCA Value");

                    eff_svg.append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", 0-5)
                            .attr("x",0 - (eff_height / 2))
                            .attr("dy", "1em")
                            .attr("font-size",18)
                            .style("text-anchor", "middle")
                            .text("Second PCA Value");




                    circles.attr("cx", function(d){
                                return three_xScale(parseFloat(d.pca_1));
                            })
                            .attr("cy", function(d){
                                return three_yScale(parseFloat(d.pca_2));
                            })
                            .attr("r", 8)
                            .attr("fill",function(d){return color(parseFloat(d['Restricted_Area-Center(C)_PERC_TOT']) + parseFloat(d['3_PERC_OF_TOT']));})
                            .attr("stroke","black")
                            .attr("stroke-width",2)
                            .attr("opacity",.95);
                }

                var effLegend = function(){
                    var colorScale = d3.scaleSequential(d3.interpolateInferno)
                                        .domain([0, eff_legend_height])

                    var bars = eff_legend_svg.selectAll("rect")
                        .data(d3.range(eff_legend_height), function(d) { return d; })
                        .enter()
                        .append("rect")
                        .attr("x", 0)
                        .attr("y", function(d, i) { return eff_legend_height - i; })
                        .attr("height", 1)
                        .attr("width", eff_legend_width)
                        .style("fill", function(d, i ) { return colorScale(d); })

                    // yscale
                    var yScale = d3.scaleLinear()
                                    .domain([d3.min(data, function(d){return parseFloat(d['Restricted_Area-Center(C)_PERC_TOT'] + d['3_PERC_OF_TOT']);}), d3.max(data, function(d){return parseFloat(d['Restricted_Area-Center(C)_PERC_TOT'] + d['3_PERC_OF_TOT']);})])
                                    .range([eff_legend_height, 0]);

                    var yAxis = d3.axisRight(yScale);

                    eff_legend_svg.append("g")
                    .attr("transform", "translate(" + eff_legend_width + ",0)")
                    .call(yAxis);

                    eff_legend_svg.append("text")
                            .attr("transform","rotate(-90)")
                            .attr("y", eff_legend_width + 34)
                            .attr("x", 0 - (eff_height/2))
                            .attr("dy", "1em")
                            .attr("font-size",18)
                            .style("text-anchor", "middle")
                            .text("Percentage of Shots from");

                    eff_legend_svg.append("text")
                            .attr("transform","rotate(-90)")
                            .attr("y", eff_legend_width + 54)
                            .attr("x", 0 - (eff_height/2))
                            .attr("dy", "1em")
                            .attr("font-size",18)
                            .style("text-anchor", "middle")
                            .text("Three or Restricted Area");


                }

                var percPlot = function(plot_svg, court_area){
                    // make the color scale for the plot
                    var color = d3.scaleSequential().domain([d3.min(data, function(d){return          parseFloat(d[court_area]);}), d3.max(data, function(d){return parseFloat(d[court_area]);})])
                                    .interpolator(d3.interpolateInferno);

                    var circles = plot_svg.selectAll("circle")
                                            .data(data)
                                            .enter()
                                            .append("circle");

                    circles.attr("cx", function(d){
                                return three_xScale(parseFloat(d.pca_1));
                            })
                            .attr("cy", function(d){
                                return three_yScale(parseFloat(d.pca_2));
                            })
                            .attr("r", 8)
                            .attr("fill",function(d){return color(d[court_area]);})
                            .attr("stroke","black")
                            .attr("stroke-width",2)
                            .attr("opacity",.95);

                }

                var addLegend = function(svg, court_area, height, width, label){
                    var colorScale = d3.scaleSequential(d3.interpolateInferno)
                                        .domain([0, height])

                    var bars = svg.selectAll("rect")
                        .data(d3.range(height), function(d) { return d; })
                        .enter()
                        .append("rect")
                        .attr("x", 0)
                        .attr("y", function(d, i) { return height - i; })
                        .attr("height", 1)
                        .attr("width", width)
                        .style("fill", function(d, i ) { return colorScale(d); })

                    // yscale
                    var yScale = d3.scaleLinear()
                                    .domain([d3.min(data, function(d){return parseFloat(d[court_area]);}), d3.max(data, function(d){return parseFloat(d[court_area]);})])
                                    .range([height, 0]);

                    var yAxis = d3.axisRight(yScale);

                    svg.append("g")
                    .attr("transform", "translate(" + width + ",0)")
                    .call(yAxis);

                    svg.append("text")
                        .attr("transform","rotate(-90)")
                        .attr("y", width + 34)
                        .attr("x", 0 - (height/2))
                        .attr("dy", "1em")
                        .attr("font-size",18)
                        .style("text-anchor", "middle")
                        .text(label);


                }

                percPlot(three_svg, "3_PERC_OF_TOT")
                addLegend(three_legend_svg, "3_PERC_OF_TOT", three_legend_height, three_legend_width, "Percentage of Shots from 3")


                percPlot(close_svg, "Restricted_Area-Center(C)_PERC_TOT")
                addLegend(close_legend_svg, "Restricted_Area-Center(C)_PERC_TOT", close_legend_height, close_legend_width, "Percentage of Shots from Restricted Area")

                effPlot()
                effLegend()




            });

            /* This plot looks at specific changes
            in Houston's PCA over time */
            d3.csv("Data/Houston.csv").then(function(data){
                var seasons = d3.map(data, function(d){return d.Season;}).keys();
                var width = 800;
                var height = 600;
                var padding = 75;
                var buffer = .02;

                // When Harden Was traded to the Rockets
                var harden0 = data.find(item => item.Season === "2011-12")
                var harden1 = data.find(item => item.Season === "2012-13")



                // When they hired Dantoni
                var dantoni0 = data.find(item => item.Season === "2015-16")
                var dantoni1 = data.find(item => item.Season === "2016-17")


                // Make the svg
                var svg = d3.select("#rockets-plot")
                            .append("svg")
                            .attr("width", width)
                            .attr("height",height)
                            .on("click",animate);


                // Make x scale
                var xScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_1);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_1);}) + buffer])
                                    .range([padding, width - padding]);

                // Make y scale
                var yScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_2);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_2);}) + buffer])
                                    .range([height - padding, padding]);

                // Make x axis
                var xAxis = d3.axisBottom(xScale);

                // Make y axis
                var yAxis = d3.axisLeft(yScale);

                // Append Axis Labels
                svg.append("text")
                    .attr("transform",
                          "translate(" + (width/2) + " ," +
                          (height - 20) + ")")
                    .style("text-anchor", "middle")
                    .attr("font-size",20)
                    .text("Shot Efficiency Measure");

                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 10)
                    .attr("x",0 - (height / 2))
                    .attr("dy", "1em")
                    .attr("font-size",20)
                    .style("text-anchor", "middle")
                    .text("Restriced Area vs. Three Measure");




                // Add in the line between 2011-12 and 2012-13
              var hardenLine = svg.append("line")
                                        .attr("x1",function() { return xScale(parseFloat(harden0.pca_1)); })
                                        .attr("y1",function() { return yScale(parseFloat(harden0.pca_2)); })
                                        .attr("x2",function() { return xScale(parseFloat(harden0.pca_1)); })
                                        .attr("y2",function() { return yScale(parseFloat(harden0.pca_2)); })
                                        .style("stroke","black")
                                        .style("stroke-width",3)
                                        .attr("opacity",0);

                // for the transition
                var hardenText = svg.append("text")
                                        .attr("font-size",20)
                                        .attr("opacity",0)
                                        .attr("x",padding + 10)
                                        .attr("y",padding + 15)
                                        .text("James Harden is traded to the Rockets in the summer of 2012");

                // add in the line for dantoni's hiring
                var dantoniLine = svg.append("line")
                                        .attr("x1",function() { return xScale(parseFloat(dantoni0.pca_1)); })
                                        .attr("y1",function() { return yScale(parseFloat(dantoni0.pca_2)); })
                                        .attr("x2",function() { return xScale(parseFloat(dantoni0.pca_1)); })
                                        .attr("y2",function() { return yScale(parseFloat(dantoni0.pca_2)); })
                                        .style("stroke","black")
                                        .style("stroke-width",3)
                                        .attr("opacity",0);

                // for the transition
                var dantoniText = svg.append("text")
                                        .attr("font-size",20)
                                        .attr("opacity",0)
                                        .attr("x",padding + 10)
                                        .attr("y",padding + 15)
                                        .text("Mike D'Antoni is hired in 2016.");


                // add the circles
                var circles = svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx",function(d){return xScale(parseFloat(d.pca_1));})
                    .attr("cy",function(d){return yScale(parseFloat(d.pca_2));})
                    .attr("Season",function(d){return d.Season;})
                    .attr("r",7)
                    .attr("id",function(d){return d.Season;})
                    .attr("fill","#CE1141")
                    .attr("stroke","#000000")
                    .attr("stroke-width",3)
                    .attr("opacity",1)
                    .append("svg:title")
                    .text(function(d) { return d.Season; });

                // add seasons
                var season_group = svg.append("g")
                                        .attr("id","season-group");


                season_group.selectAll("text")
                              .data(data)
                              .enter()
                              .append("text")
                              .attr("x",function(d){return xScale(parseFloat(d.pca_1)) - 20;})
                              .attr("y",function(d){return yScale(parseFloat(d.pca_2)) - 10;})
                              .attr("font-size",16)
                              .text(function(d){return d.Season;});

                // halt the transition and return to defaults on mouseout
                function stopAnimation() {
                    svg.selectAll("circle")
                        .interrupt("circles");

                    hardenText.interrupt("hardenText");

                    hardenLine.interrupt("hardenLine");

                    dantoniText.interrupt("dantoniText");

                    dantoniLine.interrupt("dantoniLine");

                    season_group.selectAll("text")
                                  .interrupt("text");

                    season_group.selectAll("text")
                                  .transition("text")
                                  .duration(1)
                                  .attr("opacity",1);


                    svg.selectAll("circle")
                            .transition("circles")
                            .duration(10)
                            .attr("opacity",1);



                    hardenLine.transition("hardenLine")
                                .delay(0)
                                .duration(0)
                                .attr("opacity",0)
                                .attr("x2", function(){return xScale(parseFloat(harden0.pca_1));})
                                .attr("y2", function(){return yScale(parseFloat(harden0.pca_2));});







                    dantoniLine.transition("dantoniLine")
                                .delay(0)
                                .duration(0)
                                .attr("opacity",0)
                                .attr("x2", function(){return xScale(parseFloat(dantoni0.pca_1));})
                                .attr("y2", function(){return yScale(parseFloat(dantoni0.pca_2));});

                    hardenText.transition("hardenText")
                                .delay(0)
                                .duration(0)
                                .attr("opacity",0);


                    dantoniText.transition("dantoniText")
                                .delay(0)
                                .duration(0)
                                .attr("opacity",0);
                }

                // start the transition when we mouseover the plot
                function animate() {
                  stopAnimation()

                  season_group.selectAll("text")
                          .data(data)
                          .filter(function(d){return (d.Season != "2011-12") &&
                                                      (d.Season != "2012-13");})
                          .transition("text")
                          .delay(10)
                          .duration(200)
                          .attr("opacity",0);

                  season_group.selectAll("text")
                          .data(data)
                          .filter(function(d){return (d.Season === "2011-12") ||
                                              (d.Season === "2012-13");})
                          .transition("text")
                          .delay(2800)
                          .duration(200)
                          .attr("opacity",0);

                  season_group.selectAll("text")
                          .data(data)
                          .filter(function(d){return (d.Season === "2015-16") ||
                                              (d.Season === "2016-17");})
                          .transition("text")
                          .delay(2800)
                          .duration(200)
                          .attr("opacity",1);

                  season_group.selectAll("text")
                            .data(data)
                            .transition("text")
                            .delay(6000)
                            .duration(200)
                            .attr("opacity",1)


                  svg.selectAll("circle")
                          .data(data)
                          .filter(function(d){return (d.Season != "2011-12") &&
                                                      (d.Season != "2012-13");})
                          .transition("circles")
                          .delay(10)
                          .duration(200)
                          .attr("opacity",.05);


                  svg.selectAll("circle")
                          .data(data)
                          .filter(function(d){return (d.Season === "2011-12") ||
                                                      (d.Season === "2012-13");})
                          .transition("circles")
                          .delay(2800)
                          .duration(200)
                          .attr("opacity",.05);

                  svg.selectAll("circle")
                          .data(data)
                          .filter(function(d){return (d.Season === "2015-16") ||
                                                      (d.Season === "2016-17");})
                          .transition("circles")
                          .delay(2800)
                          .duration(200)
                          .attr("opacity",1);

                  svg.selectAll("circle")
                          .data(data)
                          .transition("circles")
                          .delay(6000)
                          .duration(200)
                          .attr("opacity",1);


                  hardenLine.transition("hardenLine")
                              .delay(10)
                              .attr("opacity",1)
                              .transition("hardenLine")
                              .delay(0)
                              .duration(1200)
                              .attr("x2", function(){return xScale(parseFloat(harden1.pca_1));})
                              .attr("y2", function(){return yScale(parseFloat(harden1.pca_2));})
                              .transition("hardenLine")
                              .delay(1350)
                              .duration(0)
                              .attr("opacity",.05)
                              .transition("hardenLine")
                              .delay(3200)
                              .duration(10)
                              .attr("opacity",1)
                              .transition("hardenLine")
                              .delay(2000)
                              .duration(0)
                              .attr("opacity",0)
                              .attr("x2", function(){return xScale(parseFloat(harden0.pca_1));})
                              .attr("y2", function(){return yScale(parseFloat(harden0.pca_2));});


                  hardenText.transition("hardenText")
                              .delay(500)
                              .duration(0)
                              .attr("opacity",1)
                              .transition("hardenText")
                              .delay(2400)
                              .duration(0)
                              .attr("opacity",0);

                  dantoniLine.transition("dantoniLine")
                              .delay(2800)
                              .attr("opacity",1)
                              .transition("dantoniLine")
                              .delay(0)
                              .duration(1200)
                              .attr("x2", function(){return xScale(parseFloat(dantoni1.pca_1));})
                              .attr("y2", function(){return yScale(parseFloat(dantoni1.pca_2));})
                              .transition("dantoniLine")
                              .delay(2000)
                              .duration(0)
                              .attr("opacity",1)
                              .transition("dantoniLine")
                              .delay(1700)
                              .duration(10)
                              .attr("opacity",0)
                              .attr("x2", function(){return xScale(parseFloat(dantoni0.pca_1));})
                              .attr("y2", function(){return yScale(parseFloat(dantoni0.pca_2));});

                  dantoniText.transition("dantoniText")
                                .delay(3300)
                                .duration(0)
                                .attr("opacity",1)
                                .transition("dantoniText")
                                .delay(2000)
                                .duration(0)
                                .attr("opacity",0);


                }






                // put on the x axis
                svg.append("g")
                    .attr("transform", "translate(0, " + (height - padding) +")")
                    .call(xAxis);

                // put on the y axis
                svg.append("g")
                    .attr("transform", "translate(" + padding + ",0)")
                    .call(yAxis);








            });

            /* Cavs plot, looks at specific events over time */
            d3.csv("Data/cavs.csv").then(function(data){
                var width = 800;
                var height = 600;
                var padding = 75;
                var buffer = .02;



                var svg = d3.select("#cavs-plot")
                            .append("svg")
                            .attr("width", width)
                            .attr("height",height)
                            .on("click",animate);



                // Make x scale
                var xScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_1);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_1);}) + buffer])
                                    .range([padding, width - padding]);

                // Make y scale
                var yScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_2);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_2);}) + buffer])
                                    .range([height - padding, padding]);

                // Make x axis
                var xAxis = d3.axisBottom(xScale);

                // Make y axis
                var yAxis = d3.axisLeft(yScale);

                // Append Axis Labels
                svg.append("text")
                    .attr("transform",
                          "translate(" + (width/2) + " ," +
                          (height - 20) + ")")
                    .style("text-anchor", "middle")
                    .attr("font-size",20)
                    .text("Shot Efficiency Measure");

                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 10)
                    .attr("x",0 - (height / 2))
                    .attr("dy", "1em")
                    .attr("font-size",20)
                    .style("text-anchor", "middle")
                    .text("Restriced Area vs. Three Measure");





                svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx",function(d){return xScale(parseFloat(d.pca_1));})
                    .attr("cy",function(d){return yScale(parseFloat(d.pca_2));})
                    .attr("r",6)
                    .attr("fill","#FFB81C")
                    .attr("stroke","#6F263D")
                    .attr("stroke-width",4)
                    .attr("opacity",1)
                    .append("svg:title")
                    .text(function(d) { return d.Season; });

                // add seasons
                var season_group = svg.append("g")
                                        .attr("id","season-group");


                season_group.selectAll("text")
                              .data(data)
                              .enter()
                              .append("text")
                              .attr("x",function(d){return xScale(parseFloat(d.pca_1)) - 20;})
                              .attr("y",function(d){return yScale(parseFloat(d.pca_2)) - 10;})
                              .attr("font-size",16)
                              .text(function(d){return d.Season;});





                // put on the x axis
                svg.append("g")
                    .attr("transform", "translate(0, " + (height - padding) +")")
                    .call(xAxis);

                // put on the y axis
                svg.append("g")
                    .attr("transform", "translate(" + padding + ",0)")
                    .call(yAxis);

                var text = svg.append("text")
                              .attr("x",padding + 12)
                              .attr("y",padding + 15)
                              .attr("font-size",20)
                              .text("");



                function stopAnimate(){
                  season_group.selectAll("text")
                                .interrupt("season-group");

                  svg.selectAll("circle")
                      .interrupt("circles");

                  text.interrupt("text");

                  text.transition("text")
                      .delay(10)
                      .duration(0)
                      .text("");

                  svg.selectAll("circle")
                      .transition("circle")
                      .delay(10)
                      .duration(100)
                      .attr("r",6)
                      .attr("stroke-width",4)
                      .attr("opacity",1);

                  season_group.selectAll("text")
                              .transition("season-text")
                              .delay(10)
                              .duration(100)
                              .attr("opacity",1);
                }

                function animate(){
                  stopAnimate()

                  season_group.selectAll("text")
                              .data(data)
                              .filter(function(d){return d.Season != "2014-15" &&
                                                          d.Season != "2015-16" &&
                                                          d.Season != "2016-17" &&
                                                          d.Season != "2017-18" &&
                                                          d.Season != "2018-19";})
                              .transition("season-text")
                              .delay(20)
                              .duration(0)
                              .attr("opacity",0)
                              .transition("season-text")
                              .delay(5700)
                              .duration(0)
                              .attr("opacity",1);

                  svg.selectAll("circle")
                      .data(data)
                      .filter(function(d){return d.Season != "2014-15" &&
                                                  d.Season != "2015-16" &&
                                                  d.Season != "2016-17" &&
                                                  d.Season != "2017-18" &&
                                                  d.Season != "2018-19";})
                      .transition("circle")
                      .delay(20)
                      .duration(0)
                      .attr("opacity",.2);

                  svg.selectAll("circle")
                      .data(data)
                      .filter(function(d){return d.Season === "2014-15" ||
                                                  d.Season === "2015-16" ||
                                                  d.Season === "2016-17" ||
                                                  d.Season === "2017-18" ||
                                                  d.Season === "2018-19";})
                      .transition("circle")
                      .delay(20)
                      .duration(600)
                      .attr("r",8)
                      .attr("stroke-width",5);

                  svg.selectAll("circle")
                      .data(data)
                      .filter(function(d){return d.Season === "2014-15";})
                      .transition("circle")
                      .delay(1300)
                      .duration(400)
                      .attr("r",18)
                      .attr("stroke-width",10.8)
                      .transition("circle")
                      .delay(1400)
                      .duration(400)
                      .attr("r",10)
                      .attr("stroke-width",6);

                  svg.selectAll("circle")
                      .data(data)
                      .filter(function(d){return d.Season === "2018-19";})
                      .transition("circle")
                      .delay(3100)
                      .duration(400)
                      .attr("r",18)
                      .attr("stroke-width",10.8)
                      .transition("circle")
                      .delay(1400)
                      .duration(400)
                      .attr("r",10)
                      .attr("stroke-width",6);

                  text.transition("text")
                      .delay(400)
                      .duration(0)
                      .text("The 2014-2019 Seasons")
                      .transition("text")
                      .delay(1200)
                      .duration(0)
                      .text("LeBron Comes Home to Cleveland")
                      .transition("text")
                      .delay(1750)
                      .duration(0)
                      .text("LeBron goes to LA")
                      .transition("text")
                      .delay(1650)
                      .duration(0)
                      .text("");

                  svg.selectAll("circle")
                      .transition("circle")
                      .delay(5000)
                      .duration(600)
                      .attr("r",6)
                      .attr("stroke-width",4)
                      .attr("opacity",1);

                }




            });

            /* Nets Plot */
            d3.csv("Data/Nets.csv").then(function(data){
                var width = 800;
                var height = 600;
                var padding = 75;
                var buffer = .02;

                var nets0 = data.find(item => item.Season === "2015-16");
                var nets1 = data.find(item => item.Season === "2016-17");

                


                var svg = d3.select("#nets-plot")
                            .append("svg")
                            .attr("width", width)
                            .attr("height",height)
                            .on("click",animate);



                // Make x scale
                var xScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_1);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_1);}) + buffer])
                                    .range([padding, width - padding]);

                // Make y scale
                var yScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_2);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_2);}) + buffer])
                                    .range([height - padding, padding]);

                // Make x axis
                var xAxis = d3.axisBottom(xScale);

                // Make y axis
                var yAxis = d3.axisLeft(yScale);


                // Append Axis Labels
                svg.append("text")
                    .attr("transform",
                          "translate(" + (width/2) + " ," +
                          (height - 20) + ")")
                    .style("text-anchor", "middle")
                    .attr("font-size",20)
                    .text("Shot Efficiency Measure");

                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 10)
                    .attr("x",0 - (height / 2))
                    .attr("dy", "1em")
                    .attr("font-size",20)
                    .style("text-anchor", "middle")
                    .text("Restriced Area vs. Three Measure");

                var netsLine = svg.append("line")
                                        .attr("x1",function() { return xScale(parseFloat(nets0.pca_1)); })
                                        .attr("y1",function() { return yScale(parseFloat(nets0.pca_2)); })
                                        .attr("x2",function() { return xScale(parseFloat(nets0.pca_1)); })
                                        .attr("y2",function() { return yScale(parseFloat(nets0.pca_2)); })
                                        .style("stroke","black")
                                        .style("stroke-width",3)
                                        .attr("opacity",0);

                var netsText = svg.append("text")
                                        .attr("font-size",20)
                                        .attr("opacity",0)
                                        .attr("x", padding+10)
                                        .attr("y",padding+15)
                                        .text("Sean Marks Hires Coach Kenny Atkinson");

                // add seasons
                var season_group = svg.append("g")
                                        .attr("id","season-group");


                season_group.selectAll("text")
                              .data(data)
                              .enter()
                              .append("text")
                              .attr("x",function(d){return xScale(parseFloat(d.pca_1)) - 20;})
                              .attr("y",function(d){return yScale(parseFloat(d.pca_2)) - 10;})
                              .attr("font-size",16)
                              .text(function(d){return d.Season;});





                svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx",function(d){return xScale(parseFloat(d.pca_1));})
                    .attr("cy",function(d){return yScale(parseFloat(d.pca_2));})
                    .attr("r",6)
                    .attr("fill","#FFFFFF")
                    .attr("stroke","#000000")
                    .attr("stroke-width",4)
                    .attr("opacity",1)
                    .append("svg:title")
                    .text(function(d) { return d.Season; });



                // put on the x axis
                svg.append("g")
                    .attr("transform", "translate(0, " + (height - padding) +")")
                    .call(xAxis);

                // put on the y axis
                svg.append("g")
                    .attr("transform", "translate(" + padding + ",0)")
                    .call(yAxis);


                function animate() {
                    stopAnimate()

                    season_group.selectAll("text")
                                  .data(data)
                                  .filter(function(d){return (d.Season != "2015-16") &&
                                                              (d.Season != "2016-17");})
                                  .transition("season-text")
                                  .delay(10)
                                  .duration(10)
                                  .attr("opacity",0)
                                  .transition("season-text")
                                  .delay(3000)
                                  .duration(500)
                                  .attr("opacity",1);


                    svg.selectAll("circle")
                            .data(data)
                            .filter(function(d){return (d.Season != "2015-16") &&
                                                        (d.Season != "2016-17");})
                            .transition("circles")
                            .delay(10)
                            .duration(10)
                            .attr("opacity",.05)
                            .transition("circles")
                            .delay(3000)
                            .duration(500)
                            .attr("opacity",1);


                    netsLine.transition("netsLine")
                                .delay(10)
                                .duration(10)
                                .attr("opacity",1)
                                .transition("netsLine")
                                .delay(5)
                                .duration(1000)
                                .attr("x2",function() { return xScale(parseFloat(nets1.pca_1)); })
                                .attr("y2",function() { return yScale(parseFloat(nets1.pca_2)); })
                                .transition("netsLine")
                                .delay(4000)
                                .duration(0)
                                .attr("opacity",0)
                                .attr("x2",function() { return xScale(parseFloat(nets0.pca_1)); })
                                .attr("y2",function() { return yScale(parseFloat(nets0.pca_2)); });

                    netsText.transition("netsText")
                                .delay(100)
                                .duration(10)
                                .attr("opacity",1)
                                .transition("netsText")
                                .delay(3000)
                                .attr("opacity",0);




                }

                function stopAnimate() {
                    season_group.selectAll("text")
                                  .interrupt("season-text");

                    svg.selectAll("circle")
                        .interrupt("circles");

                    netsText.interrupt("netsText");

                    netsLine.interrupt("netsLine");

                    season_group.selectAll("text")
                                  .transition("season-text")
                                  .delay(0)
                                  .duration(0)
                                  .attr("opacity",1);

                    svg.selectAll("circle")
                            .transition("circles")
                            .delay(0)
                            .duration(0)
                            .attr("opacity",1);

                    netsLine.transition("netsLine")
                                .delay(0)
                                .duration(0)
                                .attr("opacity",0)
                                .attr("x2", function(){return xScale(parseFloat(nets0.pca_1));})
                                .attr("y2", function(){return yScale(parseFloat(nets0.pca_2));});

                    netsText.transition("netsText")
                                .transition("netsText")
                                .delay(0)
                                .attr("opacity",0);
                }


            });

            /* Sixers Plot */
            d3.csv("Data/sixers.csv").then(function(data){
              var width = 800;
              var height = 600;
              var padding = 75;
              var buffer = .02;

              var sixers0 = data.find(item => item.Season === "2012-13");
              var sixers1 = data.find(item => item.Season === "2013-14");




              var svg = d3.select("#sixers-plot")
                          .append("svg")
                          .attr("width", width)
                          .attr("height",height)
                          .on("click",animate);




              // Make x scale
              var xScale = d3.scaleLinear()
                              .domain([d3.min(data, function(d){return parseFloat(d.pca_1);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_1);}) + buffer])
                                  .range([padding, width - padding]);

              // Make y scale
              var yScale = d3.scaleLinear()
                              .domain([d3.min(data, function(d){return parseFloat(d.pca_2);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_2);}) + buffer])
                                  .range([height - padding, padding]);

              // Make x axis
              var xAxis = d3.axisBottom(xScale);

              // Make y axis
              var yAxis = d3.axisLeft(yScale);


              // Append Axis Labels
              svg.append("text")
                  .attr("transform",
                        "translate(" + (width/2) + " ," +
                        (height - 20) + ")")
                  .style("text-anchor", "middle")
                  .attr("font-size",20)
                  .text("Shot Efficiency Measure");

              svg.append("text")
                  .attr("transform", "rotate(-90)")
                  .attr("y", 10)
                  .attr("x",0 - (height / 2))
                  .attr("dy", "1em")
                  .attr("font-size",20)
                  .style("text-anchor", "middle")
                  .text("Restriced Area vs. Three Measure");

              var sixersLine = svg.append("line")
                                      .attr("x1",function() { return xScale(parseFloat(sixers0.pca_1)); })
                                      .attr("y1",function() { return yScale(parseFloat(sixers0.pca_2)); })
                                      .attr("x2",function() { return xScale(parseFloat(sixers0.pca_1)); })
                                      .attr("y2",function() { return yScale(parseFloat(sixers0.pca_2)); })
                                      .style("stroke","black")
                                      .style("stroke-width",3)
                                      .attr("opacity",0);

              var sixersText = svg.append("text")
                                      .attr("font-size",20)
                                      .attr("opacity",0)
                                      .attr("x",padding + 10)
                                      .attr("y",padding + 15)
                                      .text("The Process begins, Brett Brown is hired");





              svg.selectAll("circle")
                  .data(data)
                  .enter()
                  .append("circle")
                  .attr("cx",function(d){return xScale(parseFloat(d.pca_1));})
                  .attr("cy",function(d){return yScale(parseFloat(d.pca_2));})
                  .attr("r",6)
                  .attr("fill","#ED174C")
                  .attr("stroke","#006BB6")
                  .attr("stroke-width",4)
                  .attr("opacity",1)
                  .append("svg:title")
                  .text(function(d) { return d.Season; });

            // add seasons
            var season_group = svg.append("g")
                                    .attr("id","season-group");


            season_group.selectAll("text")
                          .data(data)
                          .enter()
                          .append("text")
                          .attr("x",function(d){return xScale(parseFloat(d.pca_1)) - 20;})
                          .attr("y",function(d){return yScale(parseFloat(d.pca_2)) - 10;})
                          .attr("font-size",16)
                          .text(function(d){return d.Season;});



              // put on the x axis
              svg.append("g")
                  .attr("transform", "translate(0, " + (height - padding) +")")
                  .call(xAxis);

              // put on the y axis
              svg.append("g")
                  .attr("transform", "translate(" + padding + ",0)")
                  .call(yAxis);


              function animate() {
                  stopAnimate()

                  season_group.selectAll("text")
                              .data(data)
                              .filter(function(d){return (d.Season != "2012-13") &&
                                                          (d.Season != "2013-14");})
                              .transition("season-text")
                              .delay(10)
                              .duration(0)
                              .attr("opacity",0);


                  season_group.selectAll("text")
                                .transition("season-text")
                                .delay(4000)
                                .duration(0)
                                .attr("opacity",1);


                  svg.selectAll("circle")
                          .data(data)
                          .filter(function(d){return (d.Season != "2012-13") &&
                                                      (d.Season != "2013-14");})
                          .transition("circles")
                          .delay(10)
                          .duration(0)
                          .attr("opacity",.05)
                          .transition("circles")
                          .delay(3800)
                          .duration(500)
                          .attr("opacity",1);


                  sixersLine.transition("sixersLine")
                              .delay(10)
                              .duration(0)
                              .attr("opacity",1)
                              .transition("sixersLine")
                              .delay(10)
                              .duration(1000)
                              .attr("x2", function(){return xScale(parseFloat(sixers1.pca_1));})
                              .attr("y2", function(){return yScale(parseFloat(sixers1.pca_2));})
                              .transition("sixersLine")
                              .delay(6000)
                              .duration(0)
                              .attr("x2", function(){return xScale(parseFloat(sixers0.pca_1));})
                              .attr("y2", function(){return yScale(parseFloat(sixers0.pca_2));})
                              .attr("opacity",0);




                  sixersText.transition("sixersText")
                              .delay(300)
                              .duration(0)
                              .attr("opacity",1)
                              .transition("sixersText")
                              .delay(3500)
                              .duration(0)
                              .attr("opacity",0);




                  }

                  function stopAnimate() {
                      svg.selectAll("circle")
                          .interrupt("circles");

                      sixersText.interrupt("sixersText");

                      sixersLine.interrupt("sixersLine");

                      season_group.selectAll("text")
                                    .interrupt("season-text");


                      season_group.selectAll("text")
                                    .transition("season-text")
                                    .delay(0)
                                    .duration(1)
                                    .attr("opacity",1);

                      svg.selectAll("circle")
                              .transition("circles")
                              .delay(0)
                              .duration(1)
                              .attr("opacity",1);

                      sixersLine.transition("sixersLine")
                                  .delay(0)
                                  .attr("opacity",0);

                      sixersLine.transition("sixersLine")
                                  .delay(10)
                                  .duration(0)
                                  .attr("x2", function(){return xScale(parseFloat(sixers0.pca_1));})
                                  .attr("y2", function(){return yScale(parseFloat(sixers0.pca_2));});

                      sixersText.transition("sixersText")
                                  .delay(0)
                                  .duration(0)
                                  .attr("opacity",0)
                                  .attr("x",padding + 10)
                                  .attr("y",padding + 15);
                  }
            })

            d3.csv("Data/14_15_use.csv").then(function(data){
                var width = 800;
                var height = 600;
                var padding = 75;
                var buffer = .02;


                var svg = d3.select("#warriors-plot")
                            .append("svg")
                            .attr("width", width)
                            .attr("height",height);


                // Make x scale
                var xScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_1);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_1);}) + buffer])
                                    .range([padding, width - padding]);

                // Make y scale
                var yScale = d3.scaleLinear()
                                .domain([d3.min(data, function(d){return parseFloat(d.pca_2);}) - buffer, d3.max(data, function(d){return parseFloat(d.pca_2);}) + buffer])
                                    .range([height - padding, padding]);

                // Make x axis
                var xAxis = d3.axisBottom(xScale);

                // Make y axis
                var yAxis = d3.axisLeft(yScale);


                // put on the x axis
                svg.append("g")
                    .attr("transform", "translate(0, " + (height - padding) +")")
                    .call(xAxis);

                // put on the y axis
                svg.append("g")
                    .attr("transform", "translate(" + padding + ",0)")
                    .call(yAxis);

                // Append Axis Labels
                svg.append("text")
                    .attr("transform",
                          "translate(" + (width/2) + " ," +
                          (height - 20) + ")")
                    .style("text-anchor", "middle")
                    .attr("font-size",20)
                    .text("Shot Efficiency Measure");

                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 10)
                    .attr("x",0 - (height / 2))
                    .attr("dy", "1em")
                    .attr("font-size",20)
                    .style("text-anchor", "middle")
                    .text("Restriced Area vs. Three Measure");

                setPlot();

                var button = d3.select("#warriors-button");

                button.on("click",function(){
                    button.removeEventListener("click");

                    warriorsSequence();

                    setTimeout(function() {
                          button.setClickable(true);
                    }, 31000);

                });

                d3.select("#warriors-button")
                  .on("click",function(){
                            d3.selectAll("circles")
                              .interrupt();

                            warriorsSequence();
                      });








                function setPlot(){
                            svg.selectAll("circle")
                                .data(data)
                                .enter()
                                .append("circle")
                                .attr("cx",function(d){return xScale(parseFloat(d.pca_1));})
                                .attr("cy",function(d){return yScale(parseFloat(d.pca_2));})
                                .attr("r",6)
                                .attr("stroke-width",4)
                                .attr("stroke","black")
                                .attr("fill","black")
                                .attr("opacity",0)
                                .filter(function(d){return d.TEAM_NAME === "Golden State Warriors";})
                                .attr("fill","#FFC72C")
                                .attr("stroke","#1D428A")
                                .attr("id","GSW");

                            svg.append("text")
                                .attr("font-size","20")
                                .attr("fill","black")
                                .attr("x",100)
                                .attr("y",100)
                                .attr("id","note")
                                .text("");

                }



                function warriorsSequence(){

                    svg.selectAll("circle")
                        .interrupt("gsw");

                    svg.selectAll("circle")
                        .interrupt("ngsw");

                    svg.selectAll("#note")
                        .interrupt("note");

                    svg.selectAll("circle")
                        .transition("start")
                        .delay(0)
                        .duration(0)
                        .attr("opacity",0);

                    var ids = ["#fourteen","#fifteen","#sixteen","#seventeen","#eighteen"];

                    ids.forEach(function (item, index) {
                      d3.select(item)
                          .interrupt("num_teams");

                      d3.select(item)
                          .transition("num_teams")
                          .text("");
                    });



                    var note = svg.selectAll("#note");



                    svg.selectAll("circle")
                        .data(data)
                        .filter(function(d){return d.Season === "2014-15" &
                                            d.TEAM_NAME === "Golden State Warriors";})
                        .transition("gsw")
                        .delay(50)
                        .duration(500)
                        .attr("opacity",1)
                        .transition("gsw")
                        .delay(5200)
                        .duration(500)
                        .attr("opacity",.3);

                    svg.selectAll("circle")
                        .data(data)
                        .filter(function(d){return d.Season === "2014-15" &&
                                                d.TEAM_NAME != "Golden State Warriors";})
                        .transition("ngsw")
                        .delay(2200)
                        .duration(500)
                        .attr("opacity",1)
                        .transition("ngsw")
                        .delay(3000)
                        .duration(500)
                        .attr("opacity",0);



                    note.transition("note")
                            .duration(500)
                            .text("The Golden State Warriors Win the Title in 2014-15.")
                            .transition("note")
                            .delay(1800)
                            .duration(0)
                            .text("The rest of the NBA in 2014-15.")
                            .transition("note")
                            .delay(3600)
                            .duration(0)
                            .text("The Warriors lose to the Cavs in 2015-16.")
                            .transition("note")
                            .delay(2200)
                            .text("The rest of the NBA in 2015-16")
                            .transition("note")
                            .delay(2700)
                            .text("Durant goes to the Warriors, they win in 2016-17")
                            .transition("note")
                            .delay(2500)
                            .text("The rest of the NBA in 2016-17")
                            .transition("note")
                            .delay(2450)
                            .text("Warriors repeat in 2017-18")
                            .transition("note")
                            .delay(2100)
                            .text("The rest of the NBA in 2017-18")
                            .transition("note")
                            .delay(3200)
                            .text("The Warriors lose to Toronto in 2018-19")
                            .transition("note")
                            .delay(2300)
                            .text("The rest of the NBA in 2018-19")
                            .transition("note")
                            .delay(3100)
                            .text("");

                   svg.selectAll("circle")
                        .data(data)
                        .filter(function(d){return d.Season === "2015-16" &&
                                                d.TEAM_NAME === "Golden State Warriors";})
                        .transition("gsw")
                        .delay(5700)
                        .duration(500)
                        .attr("opacity",1)
                        .transition("gsw")
                        .delay(4220)
                        .duration(500)
                        .attr("opacity",.3);

                    svg.selectAll("circle")
                        .data(data)
                        .filter(function(d){return d.Season === "2015-16" &&
                                                d.TEAM_NAME != "Golden State Warriors";})
                        .transition("ngsw")
                        .delay(8000)
                        .duration(500)
                        .attr("opacity",1)
                        .transition("ngsw")
                        .delay(2100)
                        .duration(500)
                        .attr("opacity",0);

                    svg.selectAll("circle")
                        .data(data)
                        .filter(function(d){return d.Season === "2016-17" &&
                                                d.TEAM_NAME === "Golden State Warriors";})
                        .transition("gsw")
                        .delay(10600)
                        .duration(800)
                        .attr("opacity",1)
                        .transition("gsw")
                        .delay(4000)
                        .duration(800)
                        .attr("opacity",.3);

                    svg.selectAll("circle")
                        .data(data)
                        .filter(function(d){return d.Season === "2016-17" &&
                                                    d.TEAM_NAME != "Golden State Warriors";})
                        .transition("ngsw")
                        .delay(13000)
                        .duration(800)
                        .attr("opacity",1)
                        .transition("ngsw")
                        .delay(1400)
                        .duration(800)
                        .attr("opacity",0);

                    svg.selectAll("circle")
                        .data(data)
                        .filter(function(d){return d.Season === "2017-18" &&
                                                    d.TEAM_NAME === "Golden State Warriors";})
                        .transition("gsw")
                        .delay(15600)
                        .duration(800)
                        .attr("opacity",1)
                        .transition("gsw")
                        .delay(4600)
                        .duration(800)
                        .attr("opacity",.3);

                    svg.selectAll("circle")
                        .data(data)
                        .filter(function(d){return d.Season === "2017-18" &&
                                                    d.TEAM_NAME != "Golden State Warriors";})
                        .transition("ngsw")
                        .delay(17600)
                        .duration(800)
                        .attr("opacity",1)
                        .transition("ngsw")
                        .delay(2600)
                        .duration(800)
                        .attr("opacity",0);

                    svg.selectAll("circle")
                        .data(data)
                        .filter(function(d){return d.Season === "2018-19" &&
                                                    d.TEAM_NAME === "Golden State Warriors";})
                        .transition("gsw")
                        .delay(20900)
                        .duration(800)
                        .attr("opacity",1);

                    svg.selectAll("circle")
                        .data(data)
                        .filter(function(d){return d.Season === "2018-19" &&
                                                    d.TEAM_NAME != "Golden State Warriors";})
                        .transition("ngsw")
                        .delay(23200)
                        .duration(800)
                        .attr("opacity",1)
                        .transition("ngsw")
                        .delay(3000)
                        .duration(800)
                        .attr("opacity",0);

                    svg.selectAll("circle")
                        .data(data)
                        .filter(function(d){return d.TEAM_NAME === "Golden State Warriors";})
                        .transition("gsw")
                        .delay(28000)
                        .duration(1000)
                        .attr("opacity",1);

                    svg.selectAll("circle")
                        .data(data)
                        .filter(function(d){return d.TEAM_NAME != "Golden State Warriors";})
                        .transition("ngsw")
                        .delay(32000)
                        .duration(1000)
                        .attr("opacity",1);

                    d3.csv("Data/num_teams_warriors.csv").then(function(data){

                      d3.select("#fourteen")
                          .transition("num_teams")
                          .delay(2400)
                          .text(data[0].NumTeams);


                      d3.select("#fifteen")
                          .transition("num_teams")
                          .delay(8100)
                          .text(data[1].NumTeams);

                      d3.select("#sixteen")
                          .transition("num_teams")
                          .delay(13100)
                          .text(data[2].NumTeams);

                    d3.select("#seventeen")
                          .transition("num_teams")
                          .delay(17800)
                          .text(data[3].NumTeams);

                    d3.select("#eighteen")
                          .transition("num_teams")
                          .delay(23300)
                          .text(data[4].NumTeams);






                    })




                };


            });



            function linspace(start, end, n) {
                var out = [];
                var delta = (end - start) / (n - 1);

                var i = 0;
                while(i < (n - 1)) {
                    out.push(start + (i * delta));
                    i++;
                }

                out.push(end);
                return out;
            }



        </script>


    </body>
</html>
